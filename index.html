<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Toggle Buttons Demo</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f6f8fa;
      padding: 24px;
    }

    .editor-container {
      background: #fff;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      overflow: hidden;
      max-width: 800px;
      margin: 0 auto;
    }

    .toggle-bar {
      display: flex;
      padding: 8px 8px 0;
      border-bottom: 1px solid #d0d7de;
      background: #f6f8fa;
      gap: 0;
    }

    .toggle-btn {
      padding: 6px 16px;
      border: 1px solid transparent;
      border-bottom: none;
      background: transparent;
      cursor: pointer;
      font-size: 14px;
      border-radius: 6px 6px 0 0;
      color: #57606a;
      position: relative;
      bottom: -1px;
      transition: background 0.1s, color 0.1s;
    }

    .toggle-btn:hover {
      background: #e8ecf0;
      color: #24292f;
    }

    .toggle-btn.active {
      background: #fff;
      border-color: #d0d7de;
      color: #24292f;
      font-weight: 500;
    }

    .panel {
      display: none;
      padding: 16px;
      min-height: 200px;
    }

    .panel.active {
      display: block;
    }

    #code-panel textarea {
      width: 100%;
      min-height: 180px;
      font-family: 'SFMono-Regular', Consolas, monospace;
      font-size: 13px;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 10px;
      resize: vertical;
      outline: none;
      color: #24292f;
      line-height: 1.5;
    }

    #code-panel textarea:focus {
      border-color: #0969da;
      box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.15);
    }

    #preview-panel {
      background: #fff;
      color: #24292f;
      line-height: 1.6;
      min-height: 200px;
    }

    #preview-panel h1, #preview-panel h2, #preview-panel h3 {
      margin: 0.5em 0 0.3em;
    }

    #preview-panel p {
      margin: 0.5em 0;
    }

    #preview-panel code {
      background: #f6f8fa;
      padding: 2px 5px;
      border-radius: 3px;
      font-family: 'SFMono-Regular', Consolas, monospace;
      font-size: 85%;
    }

    #preview-panel pre {
      background: #f6f8fa;
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
    }

    #preview-panel pre code {
      background: none;
      padding: 0;
    }

    #preview-panel blockquote {
      border-left: 4px solid #d0d7de;
      padding-left: 12px;
      color: #57606a;
      margin: 8px 0;
    }

    .preview-empty {
      color: #8c959f;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="editor-container">
    <div class="toggle-bar">
      <button class="toggle-btn active" data-panel="code-panel" id="btn-code">Code</button>
      <button class="toggle-btn" data-panel="preview-panel" id="btn-preview">Preview</button>
    </div>

    <div id="code-panel" class="panel active">
      <textarea id="editor" placeholder="Enter markdown here...">## Hello, World!

This is a **toggle button** demo.

- Click **Preview** to see the rendered output
- Click **Code** to return to the editor

> Toggle buttons work correctly when each button activates its panel and deactivates the other.

\`\`\`js
function toggle(panel) {
  // show the selected panel
  document.getElementById(panel).classList.add('active');
}
\`\`\`
</textarea>
    </div>

    <div id="preview-panel" class="panel">
      <div id="preview-content"></div>
    </div>
  </div>

  <script>
    const buttons = document.querySelectorAll('.toggle-btn');
    const panels = document.querySelectorAll('.panel');
    const textarea = document.getElementById('editor');
    const previewContent = document.getElementById('preview-content');

    function renderMarkdown(text) {
      if (!text.trim()) {
        return '<p class="preview-empty">Nothing to preview</p>';
      }

      // Basic markdown rendering
      let html = text
        // Escape HTML
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');

      // Code blocks (must come before inline code)
      html = html.replace(/```(\w*)\n([\s\S]*?)```/g, (_, lang, code) => {
        return `<pre><code>${code.trimEnd()}</code></pre>`;
      });

      // Inline code
      html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

      // Headers
      html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
      html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
      html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');

      // Bold and italic
      html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
      html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');

      // Blockquotes
      html = html.replace(/^&gt; (.+)$/gm, '<blockquote>$1</blockquote>');

      // Unordered list items
      html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
      html = html.replace(/(<li>[\s\S]+?<\/li>)/g, '<ul>$1</ul>');
      // Collapse adjacent ul tags
      html = html.replace(/<\/ul>\s*<ul>/g, '');

      // Paragraphs: wrap lines that are not already block elements
      const blockTags = /^<(h[1-6]|ul|ol|li|pre|blockquote)/;
      html = html
        .split('\n')
        .map(line => {
          if (line.trim() === '') return '';
          if (blockTags.test(line.trim())) return line;
          return `<p>${line}</p>`;
        })
        .join('\n');

      return html;
    }

    function switchPanel(targetPanelId) {
      // Deactivate all buttons and panels
      buttons.forEach(btn => btn.classList.remove('active'));
      panels.forEach(panel => panel.classList.remove('active'));

      // Activate the target button
      const targetBtn = document.querySelector(`[data-panel="${targetPanelId}"]`);
      if (targetBtn) targetBtn.classList.add('active');

      // Activate the target panel
      const targetPanel = document.getElementById(targetPanelId);
      if (targetPanel) targetPanel.classList.add('active');

      // If switching to preview, render the markdown
      if (targetPanelId === 'preview-panel') {
        previewContent.innerHTML = renderMarkdown(textarea.value);
      }
    }

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        switchPanel(btn.dataset.panel);
      });
    });
  </script>
</body>
</html>
